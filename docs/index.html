<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><title>Python Terminal-Server</title><meta name="description" content="This is a terminal-server based on <a href='https://github.com/cs01/pyxtermjs' target='_blank'>pyxtermjs</a>. A server should be started locally and shared in station mode. For more information and configuration options, see <br><a href='https://github.com/Cross-Lab-Project/edrys_module-pyxtermjs' target='_blank'>Cross-Lab-Project/edrys_module-pyxtermjs</a>"><style>html{font-family:arial}</style><link rel="stylesheet" href="https://unpkg.com/xterm@4.11.0/css/xterm.css"><meta name="show-in" content="station"><script defer src="https://edrys-org.github.io/edrys/module/vendor/alpine.min.js"></script><link rel="stylesheet" href="https://edrys-org.github.io/edrys/module/vendor/water.min.css"><link rel="stylesheet" href="https://edrys-org.github.io/edrys/module/vendor/open-iconic/css/open-iconic.min.css"><script src="https://edrys-org.github.io/edrys/module/edrys.js"></script><script src="https://unpkg.com/vue@3"></script></head><body style="max-width:100%;margin-bottom:0;padding-left:0"> <div id="app"> <span style="margin-left:2rem;font-size:small"> status: <span v-if="status === false" style="background-color:#ff8383">disconnected</span> <span v-if="status === null">connecting ...</span> <span v-if="status === true" style="background-color:#90ee90">connected</span> </span> <span style="float:right;align-items:center;font-size:small;display:flex" v-if="isStation"> <label> student: <input type="checkbox" v-model="enable.student"> </label> <label> teacher: <input type="checkbox" v-model="enable.teacher"> </label> <input type="input" style="display:inline-flex" v-model="server"> <button style="margin-right:0;display:inline-flex" @click="reload()"> reload </button> </span> <textarea style="height:4.25rem" v-model="script" v-if="isStation">
        {{script}}
      </textarea> </div> <div style="width:calc(100% + 10px)" id="terminal"></div>  <script src="/index.302fc86c.js"></script> <script src="/index.a8d293b9.js"></script> <script src="/index.cc94d01e.js"></script> <script src="/index.09b6c50e.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.min.js"></script> <script type="module">var e=function(e){for(var t=encodeURIComponent(e),n="",s=0;s<t.length;){var o=t[s];if(s+=1,"%"==o){var r=t.substring(s,s+=2);r&&(n+=String.fromCharCode(parseInt(r,16)))}else n+=o}return n};const{createApp:t}=Vue;var n=null,s=null,o=null,r=null;const i="http://localhost:5000/pty",c="echo $CODE | base64 --decode";function a(e){if(s&&n){s.fit();let t={cols:n.cols,rows:n.rows};if(e?.cols&&e?.rows&&(t=e),o)o.emit("resize",t);else try{Edrys.sendMessage("resize",JSON.stringify(t))}catch(e){}}}const d=t({data:()=>({status:null,isStation:!1,connected:!1,enable:{student:!1,teacher:!1},server:i,script:c}),methods:{reload(){o&&o.close(),this.connectStation()},execute(t){let n="\x03\x03\n"+this.script;n.endsWith("\n")||(n+="\n"),Edrys.module&&Edrys.sendMessage("input_"+Edrys.role,n.replace("$CODE",btoa(e(t))))},store(t){let n="";for(let s in t){let o=t[s];o.endsWith("\n")||(o+="\n"),n+=`echo ${btoa(e(o))} | base64 --decode > ${e(s)}
`}Edrys.module&&Edrys.sendMessage("input_"+Edrys.role,n)},initTerminal(){let e;(n=new Terminal({cursorBlink:!0,macOptionIsMeta:!0,scrollback:!0})).attachCustomKeyEventHandler(function(e){if("keydown"!==e.type)return!0;if(e.ctrlKey&&e.shiftKey){let s=e.key.toLowerCase();if("v"===s)return navigator.clipboard.readText().then(e=>{o?o.emit("pty-input",{input:e}):Edrys.module&&t(e)}),!1;if("c"===s||"x"===s){let e=n.getSelection();return navigator.clipboard.writeText(e),n.focus(),!1}}return!0}),s=new FitAddon.FitAddon,n.loadAddon(s),n.loadAddon(new WebLinksAddon.WebLinksAddon),n.loadAddon(new SearchAddon.SearchAddon),n.open(document.getElementById("terminal")),s.fit(),n.resize(12,50),s.fit(),n.writeln("Welcome to pyxterm.js!"),n.writeln("https://github.com/cs01/pyxterm.js"),n.writeln(""),n.writeln("You can copy with ctrl+shift+x"),n.writeln("You can paste with ctrl+shift+v"),n.writeln("");let t=function(e,t=500){let n="",s=null;function o(){n.length>0&&(e(n),n=""),s=null}return e=>{s&&window.clearTimeout(s),null!==e&&(n+=e),s=window.setTimeout(o,t)}}(e=>{Edrys.sendMessage("input_"+Edrys.role,e)},100);n.onData(e=>{o?o.emit("pty-input",{input:e}):Edrys.module&&t(e)}),window.onresize=function(...t){let n=this;clearTimeout(e),e=setTimeout(()=>a.apply(n,t),50)}},connectUser(){let e=this;Edrys.onMessage(({from:t,subject:s,body:o})=>{switch(s){case"pty-output":n.write(o);break;case"connect":"true"===o?e.status=!0:"false"===o?e.status=!1:e.status=null,a()}})},connectStation(){(o=io.connect(this.server,{reconnectionAttempts:1/0})).on("connect_error",e=>{console.log("Connection error:",e.message)});let e=this;o.on("pty-output",function(e){n.write(e.output),Edrys.module&&Edrys.sendMessage("pty-output",e.output),r=e.output}),o.on("connect",()=>{a(),e.status=!0,Edrys.module&&Edrys.sendMessage("connect","true"),o.emit("pty-input",{input:"\n"})}),o.on("disconnect",()=>{e.status=!1,Edrys.module&&Edrys.sendMessage("connect","false")}),Edrys.module&&(Edrys.onMessage(({from:t,subject:n,body:s})=>{switch(n){case"input_teacher":e.enable.teacher&&o.emit("pty-input",{input:s});break;case"input_student":e.enable.student&&o.emit("pty-input",{input:s});break;case"input_station":o.emit("pty-input",{input:s});break;case"join":Edrys.sendMessage("connect",JSON.stringify(e.status)),Edrys.sendMessage("pty-output",r);break;case"resize":a(JSON.parse(s))}}),Edrys.onMessage(({from:t,subject:n,body:s,module:o})=>{if(n===(Edrys.module.stationConfig?.execute||"execute")){try{let t=JSON.parse(s);if(t.file){e.store(t.file),e.execute("");return}}catch(e){console.warn("Error, could not execute command:",e.message)}e.execute(s)}},promiscuous=!0))}}}).mount("#app");d.initTerminal(),Edrys.onReady(()=>{console.log("Module is loaded!"),"station"===Edrys.role?(d.isStation=!0,d.server=Edrys.module.stationConfig?.server||i,d.script=Edrys.module.stationConfig?.script||c,d.enable.student=Edrys.module.stationConfig?.enable?.student||!1,d.enable.teacher=Edrys.module.stationConfig?.enable?.teacher||!1,d.connectStation()):d.connectUser(),Edrys.sendMessage("join",null)}),setTimeout(function(){Edrys.module||(console.warn("connect"),d.connectStation())},5e3);</script> </body></html>